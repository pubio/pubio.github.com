<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>pub.io</title>
<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.5.3/modernizr.min.js"></script>
<script src="http://js.pusher.com/1.11/pusher.min.js"></script>
<script src="http://widgets.twimg.com/j/2/widget.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">

// Google Analytics
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-33558918-1']);
_gaq.push(['_setDomainName', 'pub.io']);
_gaq.push(['_trackPageview']);

(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();

// Persistence
function setProp(key){
	localStorage[key] = document.getElementById(key).value;
}

function getProp(key){
	return key in localStorage ? localStorage[key] : "";
}

// View
function setTwitterSearch(){
	var s = document.getElementById("twitterSearch").value || "#Olympics";
	feed1.setSearch(s);
	feed1.setTitle("Watching " + s + " on Twitter");
	feed1._setUrl();
	setProp('twitterSearch');
}

$(document).ready(function() {

	$.getJSON('http://secure-shelf-4168.herokuapp.com/recommendations/?callback=?', function(json) { 
		var results = "";
		var r = json.recommendations
		for(i in r){
			results +=  "<span class='rec'>" + r[i].value + "</span>";
		}
	    $('#recommendations').html(results);
	  });
});

window.onload = function (){
	// Initialization
	if(Modernizr.localstorage){
		document.getElementById("yourName").value = getProp("yourName");
		document.getElementById("twitterSearch").value = getProp("twitterSearch");
		setTwitterSearch();
	}
	
	// Event handlers
	document.getElementById("yourName").onchange = function(){
		setProp('yourName');
	}
	
	document.getElementById("twitterSearch").onchange = function(){
		setTwitterSearch();
	}
	
	document.getElementById("selectRecommended").onclick = function(){
		document.getElementById("twitterSearch").value = document.getElementById("recommended").value;
		setTwitterSearch();
	}
	
	document.getElementById("pushRecommended").onclick = function(){
		alert("pushed \"" + document.getElementById("recommended").value + "\" to /dev/null");
	}
}

// Bind to Pusher channel
var pusher = new Pusher('5d5d9256e667b1c911a4');
var channel = pusher.subscribe('test_channel');
channel.bind('my_event', function(data) {
	document.getElementById("recommended").value = data;
});
</script>
<style>
body {
font-family: lucida grande,lucida,tahoma,helvetica,arial,sans-serif;
font-size: 10px;	
}
.rec{ border-radius: 15px; background-color: #6699ff; border-padding: 5px; height: 10px; width: 50px; }
</style>
</head>
<body>

<form>
<label>Welcome
	<input type="text" id="yourName" placeholder="Your Name" /> 
</label>
<label>Twitter Search
	<input type="text" id="twitterSearch" placeholder="#Olympics" />
</label>

<label>Peer Recommendation
	<input type="text" id="recommended" placeholder="" />
	<input type="button" id="selectRecommended" value="Select This!">  
	<input type="button" id="pushRecommended" value="Push it Forward!">
</label>
</form>
Trending Recommendations: <div id="recommendations"></div>

<script>
var feed1 = new TWTR.Widget({
  version: 2,
  type: 'search',
  search: '#olympics',
  interval: 6000,
  title: 'Watching #Olympics on Twitter',
  subject: '',
  width: '50%',
  height: 300,
  theme: {
    shell: {
      background: '#293AB1',
      color: '#ffffff'
    },
    tweets: {
      background: '#ffffff',
      color: '#444444',
      links: '#1985b5'
    }
  },
  features: {
    scrollbar: false,
    loop: true,
    live: true,
    behavior: 'default'
  }
}).render().start();
</script>


</body>
</html>