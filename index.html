<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>pub.io</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
	<link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.2.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
	body { padding-top: 60px; }
	a.rec{ color:#fff; }
    </style>
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.4/angular.min.js"></script>
<script src="js/app.js"></script>
<script src="js/controllers.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.2.2/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
<script src="http://widgets.twimg.com/j/2/widget.js"></script>
<script type="text/javascript">

// Google Analytics
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-33558918-1']);
_gaq.push(['_setDomainName', 'pub.io']);
_gaq.push(['_trackPageview']);

(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();

// Persistence
function setProp(key){
	localStorage[key] = document.getElementById(key).value;
}

function getProp(key){
	return key in localStorage ? localStorage[key] : "";
}

// View
function setTwitterSearch(){
	var s = document.getElementById("twitterSearch").value || "#Olympics";
	feed1.setSearch(s);
	feed1.setTitle("Watching " + s + " on Twitter");
	feed1._setUrl();
	setProp('twitterSearch');
}

var AJAX_URL = window.location.protocol == "file:" ? 'http://localhost:5000' : 'http://secure-shelf-4168.herokuapp.com';

window.onload = function (){
	// Initialization
	if(Modernizr.localstorage){
		document.getElementById("yourName").value = getProp("yourName");
		document.getElementById("twitterSearch").value = getProp("twitterSearch");
		setTwitterSearch();
	}
	
	// Event handlers
	document.getElementById("yourName").onchange = function(){
		setProp('yourName');
	}
	
	document.getElementById("twitterSearch").onchange = function(){
		setTwitterSearch();
	}
	
	
	$("a.rec").click(function(event){
		event.preventDefault();
		document.getElementById("twitterSearch").value = $(this).text();
		setTwitterSearch();
	 });
    
    $("#recommend").click(function(){
            event.preventDefault();
            $.post(  
                AJAX_URL + '/recommended/',  
                'recommendation=' + $("#twitterSearch").val(),  
                function(res){  
                   $("#result").html(res);
                },  
                "html"
            );
    });
	
}
</script>
</head>
<body ng-app="recommendationApp">

	<div class="navbar navbar-inverse navbar-fixed-top">
	      <div class="navbar-inner">
	        <div class="container">
	          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
	            <span class="icon-bar"></span>
	            <span class="icon-bar"></span>
	            <span class="icon-bar"></span>
	          </a>
	          <a class="brand" href="#">pub.io</a>
	          <div class="nav-collapse">
	            <ul class="nav">
	              <li class="active"><a href="#">Home</a></li>
	              <li><a href="#about">About</a></li>
	              <li><a href="#contact">Contact</a></li>
	            </ul>
	          </div><!--/.nav-collapse -->
            <form class="navbar-search pull-right">
				{{login.name}}
            </form>
              
	        </div>
	      </div>
	    </div>
	
<div class="container">

<form>
<label>Welcome
	<input type="text" id="yourName" placeholder="Your Name" /> 
</label>
<label>Twitter Search
	<input type="text" id="twitterSearch" placeholder="#Olympics" /> 
	<button class="btn" id="recommend" style="vertical-align: top;">Recommend</button>
    <span id="result"></span>
</label>
</form>

<div ng-view></div>

<script>
var feed1 = new TWTR.Widget({
  version: 2,
  type: 'search',
  search: '#olympics',
  interval: 6000,
  title: 'Watching #Olympics on Twitter',
  subject: '',
  width: '50%',
  height: 300,
  theme: {
    shell: {
      background: '#293AB1',
      color: '#ffffff'
    },
    tweets: {
      background: '#ffffff',
      color: '#444444',
      links: '#1985b5'
    }
  },
  features: {
    scrollbar: true,
    loop: true,
    live: true,
    behavior: 'default'
  }
}).render().start();
</script>

</div> <!-- end container -->

</body>
</html>
